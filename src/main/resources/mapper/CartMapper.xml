<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="yhy.project.mapper.CartMapper">

    <!--  根据用户id和商品id查询购物车  -->
    <select id="selectCartByUserIdAndGoodsId" resultType="Cart">
        select * from cart where user_id = #{userId} and goods_id = #{goodsId}
    </select>

    <!--  加入购物车  -->
    <insert id="insertCart" parameterType="Cart">
        insert into cart(title,pic,price,num,goods_id,user_id)
        values(#{title},#{pic},#{price},#{num},#{goodsId},#{userId})
    </insert>
    <!-- 更新购物车信息 -->
    <update id="updateCart" parameterType="Cart">
        update cart set title = #{title},pic = #{pic},price = #{price},num = #{num},goods_id = #{goodsId},user_id = #{userId}
        where id = #{id}
    </update>
    <!-- 查询购物车商品数量 -->
    <select id="selectCartNum" resultType="int">
        select IF(sum(num),sum(num),0) from cart where user_id = #{userId}
    </select>
    <!--  根据用户id查询购物车列表  -->
    <select id="selectCartList" resultType="Cart">
        select * from cart where user_id = #{userId}
    </select>

    <!--  根据id查询购物车信息  -->
    <select id="selectCartById" resultType="Cart">
        select * from cart where id = #{cartId}
    </select>
    <!--  根据购物车id删除商品  -->
    <delete id="deleteCartById">
        delete from cart where id = #{cartId}
    </delete>

    <!--  根据用户id查询购物车列表（含商品库存）  -->
    <select id="selectCartListByUserId" resultType="CartVo">
        select c.*, g.stock from (select * from cart where user_id = #{userId}) c
        JOIN goods g on c.goods_id = g.id
    </select>
    <!--  根据用户id删除购物车信息  -->
    <delete id="deleteCartByUserId">
        delete from cart where user_id = #{userId}
    </delete>
</mapper>